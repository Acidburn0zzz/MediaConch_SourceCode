## REST API

### Usage

This API is used by the daemon with the others client to communicate.

It is used above an HTTP connection.

### History

#### Version 1.7

* create the command for policies
  * XSLT_Policy_Create
  * Policy_Import
  * Policy_Save
  * Policy_Remove
  * Policy_Duplicate
  * Policy_Dump
  * Policy_Get_Name
  * Policy_Change_Name
  * Policy_Get
  * Policy_Get_Policies
  * Policy_Get_Policies_Names_List
  * Policy_Get_Policies_Count
  * Policy_Clear_Policies
  * XSLT_Policy_Rule_Create
  * XSLT_Policy_Rule_Get
  * XSLT_Policy_Rule_Edit
  * XSLT_Policy_Rule_Duplicate
  * XSLT_Policy_Rule_Delete

* create the policy object:
  * Policy_Policy
  * XSLT_Policy_Rule
  * Policy_Error

#### Version 1.6

* Use id for policy instead of files
* Make scope (checker) for all checker commands
* Change the name of create policy from file

#### Version 1.5

* Add the create policy from file command

#### Version 1.4

* Add the default values for type command

#### Version 1.3

* Add verbosity in report request
* Add tool in status ok
* Add VERAPDF and DPFMANAGER report kinds

#### Version 1.2

* Add the List command
* Add the Validate command
* Add the File_From_Id command

#### Version 1.1

* Add the force parameter in the Analyze request.

#### Version 1

* API created.
* Command: Analyze, Status, Report, Retry, Clear

### API

Current API version: $API_VERSION = 1.6

#### Command

* Checker_Analyze:         HTTP POST
* Checker_Status:          HTTP GET
* Checker_Report:          HTTP POST
* Checker_Retry:           HTTP PUT
* Checker_Clear:           HTTP DELETE
* Checker_List:            HTTP GET
* Checker_Validate:        HTTP POST
* Checker_File_From_Id:    HTTP POST
* Default_Values_For_type: HTTP GET

* XSLT_Policy_Create: HTTP GET
* Policy_Import: HTTP POST
* Policy_Remove: HTTP GET
* Policy_Duplicate: HTTP GET
* Policy_Dump: HTTP GET
* Policy_Save: HTTP GET
* Policy_Get_Name: HTTP GET
* Policy_Change_Name: HTTP POST
* Policy_Get: HTTP GET
* Policy_Get_Policies: HTTP GET
* Policy_Get_Policies_Names_List: HTTP GET
* Policy_Get_Policies_Count: HTTP GET
* Policy_Clear_Policies: HTTP GET
* Policy_Create_From_File: HTTP GET

#### Checker_Analyze

JSON format for the parameters.
URL: /$API_VERSION/checker_analyze

##### Request

Parameters:

* args:              Array of arguments

- file:              String: Name of the file to analyze
- id:                Integer: a unique id for the request
- force:             Boolean: force to analyze the file even if registered in database (introduced in v1.1)

##### Response

Parameters:

* ok:                Array of valid arguments

- inId:              Integer: id given by the request
- outId:             Integer: unique id generated by the daemon
- create:            Boolean: if the file was not registered

* nok: Array of invalid arguments

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### Checker_Status

URI format for the parameters.
URL: /$API_VERSION/checker_status

##### Request

Parameters:

* List of:

- id:                Integer: id given by the Analyze command

##### Response

Parameters:

* ok:                Array of valid arguments

- id:                Integer: id given by the request
- finished:          Boolean: if the file is finished to be analyzed
- done:              Double: Percent done by the analysis
- tool:              REPORT: give the report tool used to analyze, when it is finished, optionnal (Default is IMPLEMENTATION) (since API v1.3)

* nok:               Array of invalid arguments

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### Checker_Report

JSON format for the parameters.
URL: /$API_VERSION/checker_report

##### Request

Parameters:

* args:              Array of arguments

- id:                Integer: id given by the Analyze command
- reports:           Array of report kinds
- policies_contents: Array of policies contents (Strings)
- policies_ids:      Array of policies ids (Integer)
- display_content:   String:  display content
- display_name:      String:  display name (HTML, TEXT, XML, MAXML, JSTREE)
- verbosity:         Integer: verbosity of the implementation report wanted, optionnal. Value between -1 and 5. If -1 or not given, takes the one from the server (since API v1.3)

##### Response

Parameters:

* ok:                Structure of the following parameters

- report:            String: Contain the report corresponding to all requested parameters
- valid:             Boolean: true if all policies are valid (optionnal, depending on reports kind)

* nok:               Array of invalid arguments

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### Checker_Retry

JSON format for the parameters.
URL: /$API_VERSION/checker_retry

##### Request

Parameters:

* ids:              Array of id given by the Analyze command

##### Response

Parameters:

* ok:                Array of Integer: ids of the files analyzed again

* nok:               Array of invalid arguments

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### Checker_Clear

URI format for the parameters.
URL: /$API_VERSION/checker_clear

##### Request

Parameters:

* List of:

- id:                Integer: id given by the Analyze command

##### Response

Parameters:

* ok:                Array of Integer: ids of the files removed from Database

* nok:               Array of invalid arguments

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### Checker_List

No Parameter
URL: /$API_VERSION/checker_list

##### Request

Parameters:

##### Response

Parameters:

* files:             Array of files registered

- file:              Filename of the file
- id:                Internal id, id to be used by other request

#### Checker_Validate

JSON format for the parameters.
URL: /$API_VERSION/checker_validate

##### Request

Parameters:

* args:              Array of arguments

- id:                Integer: id given by the Analyze command
- report:            report kind, only POLICY or IMPLEMENTATION are possible
- policies_contents: Array of policies contents (Strings)
- policies_names:    Array of policies names (Strings)

##### Response

Parameters:

* ok:                Structure of the following parameters

- id:                Integer: Id given by the request
- valid:             Boolean: true if all policies are valid for this file

* nok:               Array of invalid arguments

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### Checker_File_From_Id

JSON format for the parameters.
URL: /$API_VERSION/checker_file_from_id

##### Request

Parameters:

- id:                Integer: id given by the Analyze command

##### Response

Parameter:

* file:              String: File corresponding to the id, left empty if id not matching

#### Default_Values_For_type

URI format for the parameters.
URL: /$API_VERSION/default_values_for_type

##### Request

Parameters:

* type:              String: name of the type wanted

##### Response

Parameters:

* values:            Array of values (String)


#### XSLT_Policy_Create

##### Request

Parameters:

URI format for the parameters.
URL: /$API_VERSION/xslt_policy_create

##### Request

Parameters:

user:      User ID
parent_id: Policy ID of the parent
type:      Policy operator ("and", "or"; default is "and")

##### Response

Parameters:

- if command is ok, return an object with the id of the created policy: '{"XSLT_POLICY_CREATE_RESULT": {"id": 0}}'
- otherwise, return a "nok" object with a Policy_Error
{"XSLT_POLICY_CREATE_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Import

JSON format for the parameters.
URL: /$API_VERSION/policy_import

##### Request

Parameters:

user:  User ID
xml:   XML corresponding to the policy
{\"POLICY_IMPORT\": {\"xml\": \"$XML_DATA\"}}

##### Response

Parameters:

- if command is ok, return an object with the id of the created policy: '{"POLICY_IMPORT_RESULT": {"id": 0}}'
- otherwise, return a "nok" object with a Policy_Error
{"POLICY_IMPORT_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Remove

URI format for the parameters.
URL: /$API_VERSION/policy_remove?id=0

##### Request

Parameters:

user:  User ID
id:    Policy ID to remove

##### Response

Parameters:

- If command is ok, return an Empty object '{"POLICY_REMOVE_RESULT": {}}'
- Otherwise, return a "nok" object with a Policy_Error
{"POLICY_REMOVE_RESULT": {"nok": {\"error\":\"ERROR\"}}}

#### Policy_Dump

URI format for the parameters.
URL: /$API_VERSION/policy_dump?id=0

##### Request

Parameters:

user:  User ID
id:    Policy ID to dump

##### Response

Parameters:

- If command is ok, return an object with the XML of the policy '{"POLICY_DUMP_RESULT": {"xml": "POLICY_XML"}}'
- Otherwise, return a "nok" object with a Policy_Error
{"POLICY_DUMP_RESULT": {"nok": {\"error\":\"ERROR\"}}}

#### Policy_Save

URI format for the parameters.
URL: /$API_VERSION/policy_save?id=0

##### Request

Parameters:

user:  User ID
id:    Policy ID to save

##### Response

Parameters:

- If command is ok, return an Empty object '{"POLICY_SAVE_RESULT": {}}'
- Otherwise, return a "nok" object with a Policy_Error
{"POLICY_SAVE_RESULT": {"nok": {\"error\":\"ERROR\"}}}

#### Policy_Duplicate

URI format for the parameters.
URL: /$API_VERSION/policy_duplicate?id=0

##### Request

Parameters:

user:  User ID
id:    Policy ID to duplicate

##### Response

Parameters:

- If command is ok, return an object with the new ID '{"POLICY_DUPLICATE_RESULT": {"id": 0}}'
- Otherwise, return a "nok" object with a Policy_Error
{"POLICY_DUPLICATE_RESULT": {"nok": {\"error\":\"ERROR\"}}}

#### Policy_Get_Name

URI format for the parameters.
URL: /$API_VERSION/policy_get_name?id=0

##### Request

Parameters:

user:  User ID
id:    Policy ID to retrieve information

##### Response

Parameters:

- If command is ok, return an object with the name '{"POLICY_GET_NAME_RESULT": {"name": "New policy"}}'
- Otherwise, return a "nok" object with a Policy_Error
{"POLICY_GET_NAME_RESULT": {"nok": {\"error\":\"ERROR\"}}}

#### Policy_Change_Name

JSON format for the parameters.
URL: /$API_VERSION/policy_change_name"

##### Request

Parameters:

user:        User ID
id:          Policy ID to retrieve information
name:        New name for the policy
description: New description for the policy
'{"POLICY_CHANGE_NAME":{"id": 0, "name": "changed name", "description": "changed description"}}'

##### Response

Parameters:

- If command is ok, return an empty object '{"POLICY_CHANGE_NAME_RESULT": {}}'
- Otherwise, return a "nok" object with a Policy_Error
{"POLICY_CHANGE_NAME": {"nok": {\"error\":\"ERROR\"}}}

#### Policy_Get

Parameters:

URI format for the parameters.
URL: /$API_VERSION/policy_get?id=0

##### Request

Parameters:

user:  User ID
id:    Policy ID

##### Response

Parameters:

- if command is ok, return a Policy_Policy: '{"POLICY_GET_RESULT": {"policy": {"type": "and", "id": 0, "description": "", "parent_id": -1, "name": "New policy", "is_system": false}}}'
- otherwise, return a "nok" object with a Policy_Error
{"POLICY_GET_POLICIES_COUNT_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Get_Policies_Count

URI format for the parameters.
URL: /$API_VERSION/policy_get_policies_count

##### Request

Parameters:

user:  User ID

##### Response

Parameters:

- if command is ok, return an object with the number of policies for the user in size: '{"POLICY_GET_POLICIES_COUNT_RESULT": {"size": 0}}'
- otherwise, return a "nok" object with a Policy_Error
{"POLICY_GET_POLICIES_COUNT_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Get_Policies

Parameters:

URI format for the parameters.
URL: /$API_VERSION/policy_get_policies?id=0&id=1

##### Request

Parameters:

user:  User ID
id:    Policy ID (can be cumulated), if not present, return all policies

##### Response

Parameters:

- if command is ok, return an object with an array of policies (Policy_Policy): '{"POLICY_GET_POLICIES_RESULT": {"policies": []}}'
- otherwise, return a "nok" object with a Policy_Error
{"POLICY_GET_POLICIES_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Get_Policies_Names_List

Parameters:

URI format for the parameters.
URL: /$API_VERSION/policy_get_policies_names_list

##### Request

Parameters:

user:  User ID

##### Response

Parameters:

- if command is ok, return an object with an array of policies ids and names: '{"POLICY_GET_POLICIES_RESULT": {"policies": [{\"id\":0,\"name\":\"policy name\"}]}}'
- otherwise, return a "nok" object with a Policy_Error
{"POLICY_GET_POLICIES_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Clear_Policies

URI format for the parameters.
URL: /$API_VERSION/policy_clear_policies

##### Request

Parameters:

user:  User ID

##### Response

Parameters:

- if command is ok, return an empty object: '{"POLICY_CLEAR_POLICIES_RESULT": {}}'
- otherwise, return a "nok" object with a Policy_Error
{"POLICY_CLEAR_POLICIES_RESULT": {"nok": {"error":"ERROR"}}}

#### XSLT_Policy_Create_From_File

URI format for the parameters.
URL: /$API_VERSION/xslt_policy_create_from_file

##### Request

Parameters:

user:  User ID

##### Response

Parameters:

##### Request

Parameters:

* user:              Integer: User ID
* id:                Integer: Id given by analyze for a file

##### Response

Parameters:

* policy_id:         ID of the created XSL policy

* nok:               Object

- id:                Integer: id given by the request
- error:             Integer: Error code corresponding to the error

#### XSLT_Policy_Rule_Create

##### Request

Parameters:

URI format for the parameters.
URL: /$API_VERSION/xslt_policy_rule_create?policy_id=0

##### Request

Parameters:

user:      User ID
policy_id: Policy ID of the parent (XSLT) policy

##### Response

Parameters:

- if command is ok, return an object with the id of the created rule: '{"XSLT_POLICY_RULE_CREATE_RESULT": {"id": 0}}'
- otherwise, return a "nok" object with a Policy_Error
{"XSLT_POLICY_RULE_CREATE_RESULT": {"nok": {"error":"ERROR"}}}

#### XSLT_Policy_Rule_Get

##### Request

Parameters:

URI format for the parameters.
URL: /$API_VERSION/xslt_policy_rule_get?policy_id=0&id=0

##### Request

Parameters:

user:      User ID
policy_id: Policy ID of the parent (XSLT) policy
id:        Rule ID of the rule wanted

##### Response

Parameters:

- if command is ok, return a XSLT_Policy_Rule: '{"XSLT_POLICY_RULE_GET_RESULT": {"rule": {"field": "", "id": 0, "occurrence": -1, "name": "New Rule", "ope": "", "tracktype": "", "value": ""}}}'
- otherwise, return a "nok" object with a Policy_Error
{"XSLT_POLICY_RULE_CREATE_RESULT": {"nok": {"error":"ERROR"}}}

#### XSLT_Policy_Rule_Edit

##### Request

Parameters:

JSON format for the parameters.
URL: /$API_VERSION/xslt_policy_rule_edit

##### Request

Parameters:

user:      User ID
policy_id: Policy ID of the parent (XSLT) policy
rule:      Contains a XSLT_Policy_Rule object, use the "id" value to find the correct rule

'{"XSLT_POLICY_RULE_EDIT": {"rule": {"field": "Format", "id": 0, "occurrence": -1, "name": "General Format is Matroska", "ope": "is_equal", "tracktype": "General", "value": "Matroska"}}}'

##### Response

Parameters:

- if command is ok, return an empty object: '{"XSLT_POLICY_RULE_EDIT_RESULT": {}}'
- otherwise, return a "nok" object with a Policy_Error
{"XSLT_POLICY_RULE_EDIT_RESULT": {"nok": {"error":"ERROR"}}}

#### XSLT_Policy_Rule_Duplicate

##### Request

Parameters:

URI format for the parameters.
URL: /$API_VERSION/xslt_policy_rule_duplicate?policy_id=0&id=0

##### Request

Parameters:

user:      User ID
policy_id: Policy ID of the parent (XSLT) policy
id:        Rule ID of the rule to duplicate

##### Response

Parameters:

- if command is ok, return an object with the new Rule ID: '{"XSLT_POLICY_RULE_DUPLICATE_RESULT": {"id": 17}}}'
- otherwise, return a "nok" object with a Policy_Error
{"XSLT_POLICY_RULE_DUPLICATE_RESULT": {"nok": {"error":"ERROR"}}}

#### XSLT_Policy_Rule_Delete

##### Request

Parameters:

URI format for the parameters.
URL: /$API_VERSION/xslt_policy_rule_delete?policy_id=0&id=0

##### Request

Parameters:

user:      User ID
policy_id: Policy ID of the parent (XSLT) policy
id:        Rule ID of the rule to delete

##### Response

Parameters:

- if command is ok, return an empty object: '{"XSLT_POLICY_RULE_DELETE_RESULT": {}}'
- otherwise, return a "nok" object with a Policy_Error
{"XSLT_POLICY_RULE_DELETE_RESULT": {"nok": {"error":"ERROR"}}}

#### Policy_Policy

Policy Object

Parameters:

* id:          ID of the policy
* parent_id:   ID of the parent policy (optional, root is -1)
* name:        string containing the name of the policy (optional)
* kind:        string containing the policy kind ("UNKNOWN" or "XSLT")
* type:        string containing the policy operator (optional; value: "and", "or"; default is "and")
* is_system:   boolean set to true if it is a system policy
* description: string containing the name of the policy (optional)

{"id":0, "parent_id":-1, "name": "NAME", "description":"", "type":"and"}

#### XSLT_Policy_Rule

Policy Object

Parameters:

* id:         ID of the rule inside the policy
* name:       Name of the rule
* tracktype:  Track type of the rule
* field:      Field of the rule
* occurrence: Number of occurrence of the field
* ope:        Operator of the Rule
* value:      Value of the rule

{"id":0, "name": "NAME", "tracktype": "TYPE", "field":"FIELD", "occurrence":-1, "ope":"is_existing", value=""}

#### Policy_Error

Policy Object

Parameters:

* error: string corresponding to the error
{\"error\"=\"ERROR\"}

#### Report kinds

* NO\_REPORT:      0
* POLICY:         1
* IMPLEMENTATION: 2
* MEDIAINFO:      3
* MEDIATRACE:     4
* VERAPDF:        5
* DPFMANAGER:     6

#### Error reason

* NO\_REASON           0
* FILE\_NOT\_EXISTING   1
* ID\_NOT\_EXISTING     2
* NOT\_READY            3
